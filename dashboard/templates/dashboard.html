{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap">
  <link rel="stylesheet" href="{% static 'assets/css/dashboard-theme.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css">
  <style>
    .dashboard-main {
      margin-left: 250px;
      min-height: 100vh;
      background: #f8fafc;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 2rem 0;
      overflow-x: hidden;
    }

    .dashboard-content {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    .dashboard-header {
      text-align: left;
      margin-bottom: 2.5rem;
    }

    .dashboard-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2d3a4b;
      margin-bottom: 0.5rem;
    }

    .dashboard-desc {
      color: #6c63ff;
      font-size: 1.1rem;
      margin-bottom: 0;
    }

    .dashboard-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 1.5rem;
      justify-content: center;
      align-items: start;
      width: 100%;
    }

    .section-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 2rem;
      display: flex;
      flex-direction: column;
      min-height: 320px;
      transition: transform 0.2s, box-shadow 0.2s;
      margin: 0.25rem; /* subtle spacing around each frame */
    }

    .section-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }

    .section-card h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #2d3a4b;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-card h2 i {
      color: #6c63ff;
      font-size: 1.3rem;
    }

    .edit-btn {
      background: #6c63ff;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: auto;
      transition: background 0.2s;
    }

    .edit-btn:hover { 
      background: #554ee2; 
    }

    .delete-btn { 
      background: #d32f2f !important; 
      color: #fff !important; 
      margin-left: 8px; 
    }

    .item-list { 
      list-style: none; 
      padding: 0; 
      margin: 0; 
      flex: 1;
    }

    .item-list li {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem 1rem;
      padding: 0.9rem 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 1.02rem;
      align-items: flex-start;
    }

    .item-list li:last-child { 
      border-bottom: none; 
    }

    .item-icon { 
      color: #6c63ff; 
      font-size: 1.2em; 
      min-width: 1.5em; 
      text-align: center; 
    }

    .item-content {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
      min-width: 0; /* allow wrapping */
      flex: 1 1 320px; /* grow, shrink with a sensible base */
    }

    .item-title { 
      font-weight: 600; 
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    .item-meta { 
      color: #888; 
      font-size: 0.95em; 
      margin-left: 0.5em; 
      overflow-wrap: anywhere;
      word-break: break-word;
      align-self: center;
      flex: 0 1 220px; /* allow meta to wrap but not squeeze content too much */
    }

    .item-edit-btn {
      margin-left: auto;
      background: #6c63ff;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.4em 1em;
      font-size: 0.98em;
      cursor: pointer;
      transition: background 0.2s;
    }

    .item-edit-btn:hover { 
      background: #554ee2; 
    }

    .item-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-left: auto; /* push to the right */
      flex: 0 0 auto;
    }

    .item-delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 0.4em 0.6em;
      border-radius: 6px;
      font-size: 0.98em;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
    }
    
    .item-delete-btn:hover {
      background: #c0392b;
    }

    .item-delete-btn i {
      font-size: 0.9em;
    }

    @media (max-width: 1024px) {
      .dashboard-sections {
        gap: 1.5rem;
      }
      
      .section-card {
        min-height: 280px;
      }
    }

    @media (max-width: 900px) {
      .dashboard-sections {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .section-card {
        min-height: auto;
      }
      
      .dashboard-content {
        padding: 0 1rem;
      }
    }

    @media (max-width: 600px) {
      .dashboard-main {
        margin-left: 0;
        padding: 1rem 0;
      }
      
      .dashboard-content {
        padding: 0 1rem;
      }
      
      .dashboard-title {
        font-size: 2rem;
      }
      
      .section-card {
        padding: 1.5rem;
      }

      .item-content { flex-basis: 100%; }
      .item-meta { flex-basis: 100%; margin-left: 2.1rem; }
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <div class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </div>

  <!-- Off-canvas Mobile Menu -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
  <aside class="sidebar mobile-sidebar" id="mobileSidebar">
    <div class="mobile-menu-header">
      <div class="profile">
        <div class="home__img" style="margin: 0 auto;">
          <svg class="home__blob" viewBox="0 0 200 187" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <mask id="mask0" mask-type="alpha">
              <path d="M190.312 36.4879C206.582 62.1187 201.309 102.826 182.328 134.186C163.346 165.547 130.807 187.559 100.226 186.353C69.6454 185.297 41.0228 161.023 21.7403 129.362C2.45775 97.8511 -7.48481 59.1033 6.67581 34.5279C20.9871 10.1032 59.7028 -0.149132 97.9666 0.00163737C136.23 0.303176 174.193 10.857 190.312 36.4879Z"/>
            </mask>
            <g mask="url(#mask0)">
              <path d="M190.312 36.4879C206.582 62.1187 201.309 102.826 182.328 134.186C163.346 165.547 130.807 187.559 100.226 186.353C69.6454 185.297 41.0228 161.023 21.7403 129.362C2.45775 97.8511 -7.48481 59.1033 6.67581 34.5279C20.9871 10.1032 59.7028 -0.149132 97.9666 0.00163737C136.23 0.303176 174.193 10.857 190.312 36.4879Z"/>
              <image class="home__blob-img" id="sidebarProfileImg" x="12" y="18" href="" alt="Profile Image"/>
            </g>
          </svg>
        </div>
        <!-- <h3 id="sidebarUserName">Loading...</h3>
        <p id="sidebarUserRole">Loading...</p> -->
      </div>
      <button class="mobile-menu-close" id="mobileMenuClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <nav>
      <a href="/dashboard" class="active"><i class="fas fa-th-large"></i>Dashboard</a>
      <a href="/about"><i class="fas fa-user"></i>About</a>
      <a href="/skills"><i class="fas fa-code"></i>Skills</a>
      <a href="/qualifications"><i class="fas fa-graduation-cap"></i>Qualifications</a>
      <a href="/services"><i class="fas fa-briefcase"></i>Services</a>
      <a href="/portfolio"><i class="fas fa-folder-open"></i>Portfolio</a>
      <a href="/testimonials"><i class="fas fa-comments"></i>Testimonial</a>
      <a href="/contact"><i class="fas fa-envelope"></i>Contact</a>
    </nav>
  </aside>

  <!-- Desktop Sidebar -->
  <aside class="dashboard-sidebar desktop-sidebar">
    <div class="profile">
      <div class="home__img" style="margin: 0 auto;">
        <svg class="home__blob" viewBox="0 0 200 187" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <mask id="mask0" mask-type="alpha">
            <path d="M190.312 36.4879C206.582 62.1187 201.309 102.826 182.328 134.186C163.346 165.547 130.807 187.559 100.226 186.353C69.6454 185.297 41.0228 161.023 21.7403 129.362C2.45775 97.8511 -7.48481 59.1033 6.67581 34.5279C20.9871 10.1032 59.7028 -0.149132 97.9666 0.00163737C136.23 0.303176 174.193 10.857 190.312 36.4879Z"/>
          </mask>
          <g mask="url(#mask0)">
            <path d="M190.312 36.4879C206.582 62.1187 201.309 102.826 182.328 134.186C163.346 165.547 130.807 187.559 100.226 186.353C69.6454 185.297 41.0228 161.023 21.7403 129.362C2.45775 97.8511 -7.48481 59.1033 6.67581 34.5279C20.9871 10.1032 59.7028 -0.149132 97.9666 0.00163737C136.23 0.303176 174.193 10.857 190.312 36.4879Z"/>
            <image class="home__blob-img" id="sidebarProfileImg" x="12" y="18" href="" alt="Profile Image"/>
          </g>
        </svg>
      </div>
      <!-- <h3 id="sidebarUserName">Loading...</h3>
      <p id="sidebarUserRole">Loading...</p> -->
    </div>
    <nav>
      <a href="/dashboard" class="active"><i class="fas fa-th-large"></i>Dashboard</a>
      <a href="/about"><i class="fas fa-user"></i>About</a>
      <a href="/skills"><i class="fas fa-code"></i>Skills</a>
      <a href="/qualifications"><i class="fas fa-graduation-cap"></i>Qualifications</a>
      <a href="/services"><i class="fas fa-briefcase"></i>Services</a>
      <a href="/portfolio"><i class="fas fa-folder-open"></i>Portfolio</a>
      <a href="/testimonials"><i class="fas fa-comments"></i>Testimonial</a>
      <a href="/contact"><i class="fas fa-envelope"></i>Contact</a>
    </nav>
  </aside>

  <main class="dashboard-main">
    <div class="dashboard-content">
      <div class="dashboard-header">
        <div class="dashboard-title">Dashboard</div>
        <div class="dashboard-desc">Gérez votre portfolio et vos informations personnelles.</div>
      </div>
      
      <div class="dashboard-sections">
        <div class="section-card" id="aboutSection">
          <h2><i class="fas fa-user"></i>About Me</h2>
          <div id="aboutContent">
            <p>Aucune information enregistrée. Veuillez ajouter une description personnelle pour enrichir votre profil.</p>
          </div>
          <!-- <button class="edit-btn" onclick="location.href='/about'">Edit</button> -->
        </div>
        
        <div class="section-card" id="skillsSection">
          <h2><i class="fas fa-code"></i>Skills</h2>
          <ul id="skillsList" class="item-list">
            <li>Aucune compétence ajoutée pour le moment.</li>
          </ul>
          <!-- <button class="edit-btn" onclick="location.href='/skills'">Edit</button> -->
        </div>
        
        <div class="section-card" id="qualificationsSection">
          <h2><i class="fas fa-graduation-cap"></i>Qualifications</h2>
          <ul id="qualificationsList" class="item-list">
            <li>Vous n'avez pas encore renseigné vos diplômes ou certificats.</li>
          </ul>
          <!-- <button class="edit-btn" onclick="location.href='/qualifications'">Edit</button> -->
        </div>
        
        <div class="section-card" id="servicesSection">
          <h2><i class="fas fa-briefcase"></i>Services</h2>
          <ul id="servicesList" class="item-list">
            <li>Vos services proposés n'apparaissent pas encore.</li>
          </ul>
          <!-- <button class="edit-btn" onclick="location.href='/services'">Edit</button> -->
        </div>
        
        <div class="section-card" id="portfolioSection">
          <h2><i class="fas fa-folder-open"></i>Portfolio</h2>
          <ul id="portfolioList" class="item-list">
            <li>Vous n'avez pas encore ajouté de projets.</li>
          </ul>
          <!-- <button class="edit-btn" onclick="location.href='/portfolio'">Edit</button> -->
        </div>
        
        <div class="section-card" id="testimonialSection">
          <h2><i class="fas fa-comments"></i>Testimonial</h2>
          <ul id="testimonialsList" class="item-list">
            <li>Aucun témoignage pour l'instant.</li>
          </ul>
          <!-- <button class="edit-btn" onclick="location.href='/testimonials'">Edit</button> -->
        </div>
      </div>
    </div>
  </main>
  <script>
    // ABOUT
    async function loadAboutCard() {
      const aboutContent = document.getElementById('aboutContent');
      try {
        const response = await fetch('{{ base_url }}/api/about/');
        const result = await response.json();
        if (result.success && result.data && result.data.length > 0) {
          const about = result.data[0];
          let photoHtml = about.photo ? `<img src="${about.photo}" alt="Photo" style="max-width:60px; border-radius:50%; margin-bottom:10px;">` : '';
          let cvHtml = about.cv ? `<a href="${about.cv}" target="_blank" style="display:inline-block;margin-top:8px;">Télécharger le CV</a>` : '';
          aboutContent.innerHTML = `
            <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
              ${photoHtml}
              <div style="flex:1;">
                <p style="margin-bottom:8px;">${about.bio}</p>
                ${cvHtml}
              </div>
            </div>
            <div style="margin-top:10px;display:flex;gap:8px;">
              <button class="item-edit-btn" onclick="location.href='/about/edit/${about.id}/'">Edit</button>
              <button class="item-delete-btn" onclick="deleteAbout(${about.id})" title="Supprimer le profil">
                <i class="fa fa-trash"></i> 
              </button>
            </div>
          `;
        }
      } catch (err) {}
    }
    // SKILLS
    async function loadSkills() {
      const skillsList = document.getElementById('skillsList');
      try {
        const response = await fetch('{{ base_url }}/api/skills/');
        const result = await response.json();
        if (result.success && result.data && result.data.length > 0) {
          let html = '';
          for (const skill of result.data) {
            html += `<li>
              <div class="item-content">
                <span class="item-icon"><i class="fas fa-layer-group"></i></span>
                <span class="item-title">${skill.skill}</span>
              </div>
              <span class="item-meta">${skill.level}</span>
              <div class="item-actions">
                <button class="item-edit-btn" onclick="location.href='/skills/edit/${skill.id}/'">Edit</button>
                <button class="item-delete-btn" onclick="deleteSkill(${skill.id})" title="Supprimer la compétence">
                  <i class="fas fa-trash"></i> 
                </button>
              </div>
            </li>`;
          }
          skillsList.innerHTML = html;
        }
      } catch (err) {}
    }
    // QUALIFICATIONS
    async function loadQualifications() {
      const qualificationsList = document.getElementById('qualificationsList');
      try {
        const response = await fetch('{{ base_url }}/api/qualifications/');
        const result = await response.json();
        if (result.success && result.data && result.data.length > 0) {
          let html = '';
          for (const q of result.data) {
            html += `<li>
              <div class="item-content">
                <span class="item-icon"><i class="fas fa-user-graduate"></i></span>
                <span class="item-title">${q.diploma}</span>
              </div>
              <span class="item-meta">${q.institution} - ${q.year}</span>
              <div class="item-actions">
                <button class="item-edit-btn" onclick="location.href='/qualifications/edit/${q.id}/'">Edit</button>
                <button class="item-delete-btn" onclick="deleteQualification(${q.id})" title="Supprimer la qualification">
                  <i class="fas fa-trash"></i> 
                </button>
              </div>
            </li>`;
          }
          qualificationsList.innerHTML = html;
        }
      } catch (err) {}
    }
    // SERVICES
    async function loadServices() {
      const servicesList = document.getElementById('servicesList');
      try {
        const response = await fetch('{{ base_url }}/api/services/');
        const result = await response.json();
        if (result.success && result.data && result.data.length > 0) {
          let html = '';
          for (const s of result.data) {
            html += `<li>
              <div class="item-content">
                <span class="item-icon"><i class="fas fa-pen-nib"></i></span>
                <span class="item-title">${s.service}</span>
              </div>
              <span class="item-meta">${s.description}</span>
              <div class="item-actions">
                <button class="item-edit-btn" onclick="location.href='/services/edit/${s.id}/'">Edit</button>
                <button class="item-delete-btn" onclick="deleteService(${s.id})" title="Supprimer">
                  <i class="fas fa-trash"></i> 
                </button>
              </div>
            </li>`;
          }
          servicesList.innerHTML = html;
        }
      } catch (err) {}
    }
    // PORTFOLIO
    async function loadPortfolio() {
      const portfolioList = document.getElementById('portfolioList');
      try {
        const response = await fetch('{{ base_url }}/api/portfolio/');
        const result = await response.json();
        if (result.success && result.data && result.data.length > 0) {
          let html = '';
          for (const p of result.data) {
            let imgHtml = p.image ? `<img src="${p.image}" alt="Projet" style="max-width:60px;max-height:40px;border-radius:8px;">` : '';
            html += `<li>
              <div class="item-content">
                <span class="item-icon"><i class="fas fa-folder"></i></span>
                <span class="item-title">${p.title}</span>
              </div>
              <span class="item-meta">${p.description}</span>
              ${imgHtml}
              <div class="item-actions">
                <button class="item-edit-btn" onclick="location.href='/portfolio/edit/${p.id}/'">Edit</button>
                <button class="item-delete-btn" onclick="deletePortfolio(${p.id})" title="Supprimer le projet">
                  <i class="fas fa-trash"></i> 
                </button>
              </div>
            </li>`;
          }
          portfolioList.innerHTML = html;
        }
      } catch (err) {}
    }
    // TESTIMONIALS
    async function loadTestimonials() {
      const testimonialsList = document.getElementById('testimonialsList');
      try {
        const response = await fetch('{{ base_url }}/api/testimonials/');
        const result = await response.json();
        if (result.success && result.data && result.data.length > 0) {
          let html = '';
          for (const t of result.data) {
            html += `<li>
              <div class="item-content">
                <span class="item-icon"><i class="fas fa-comment-dots"></i></span>
                <span class="item-title">${t.author}</span>
              </div>
              <span class="item-meta">${t.testimonial}</span>
              <div class="item-actions">
                <button class="item-edit-btn" onclick="location.href='/testimonials/edit/${t.id}/'">Edit</button>
                <button class="item-delete-btn" onclick="deleteTestimonial(${t.id})" title="Supprimer">
                  <i class="fas fa-trash"></i> 
                </button>
              </div>
            </li>`;
          }
          testimonialsList.innerHTML = html;
        }
      } catch (err) {}
    }
    window.addEventListener('DOMContentLoaded', () => {
      loadAboutCard();
      loadSkills();
      loadQualifications();
      loadServices();
      loadPortfolio();
      loadTestimonials();
    });
    fetch('{{ base_url }}/api/about/')
      .then(response => response.json())
      .then(result => {
        if (Array.isArray(result.data) && result.data.length > 0) {
          const about = result.data[0];
          
          // Update all profile images (both mobile and desktop)
          const profileImages = document.querySelectorAll('#sidebarProfileImg');
          profileImages.forEach(img => {
            if (about.photo) {
              img.setAttribute('href', about.photo);
            }
          });
          
          // Update all user names (both mobile and desktop)
          const userNames = document.querySelectorAll('#sidebarUserName');
          userNames.forEach(userName => {
            if (about.first_name && about.last_name) {
              userName.textContent = `${about.first_name} ${about.last_name}`;
            }
          });
          
          // Update all user roles (both mobile and desktop)
          const userRoles = document.querySelectorAll('#sidebarUserRole');
          userRoles.forEach(userRole => {
            if (about.profession) {
              userRole.textContent = about.profession;
            }
          });
        }
      })
      .catch(err => {
        console.error('Failed to load profile image:', err);
    });

    // Mobile menu functionality
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const mobileSidebar = document.getElementById('mobileSidebar');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    const mobileMenuClose = document.getElementById('mobileMenuClose');

    console.log('Mobile menu elements:', {
      toggle: mobileMenuToggle,
      sidebar: mobileSidebar,
      overlay: mobileMenuOverlay,
      close: mobileMenuClose
    });

    function openMobileMenu() {
      console.log('Opening mobile menu');
      console.log('Mobile sidebar element:', mobileSidebar);
      console.log('Mobile sidebar classes before:', mobileSidebar.className);
      mobileSidebar.classList.add('active');
      console.log('Mobile sidebar classes after:', mobileSidebar.className);
      mobileMenuOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Force show the mobile sidebar
      mobileSidebar.style.display = 'flex';
      mobileSidebar.style.left = '0';
    }

    function closeMobileMenu() {
      console.log('Closing mobile menu');
      mobileSidebar.classList.remove('active');
      mobileMenuOverlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    if (mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', openMobileMenu);
    }
    
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', closeMobileMenu);
    }
    
    if (mobileMenuOverlay) {
      mobileMenuOverlay.addEventListener('click', closeMobileMenu);
    }

    // Close menu when clicking on a link
    const mobileNavLinks = mobileSidebar.querySelectorAll('nav a');
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMobileMenu();
      }
    });

    // Preview functionality
    function checkFormCompletion() {
      // Check if all forms have been filled
      const hasAbout = localStorage.getItem('about_completed') === 'true';
      const hasSkills = localStorage.getItem('skills_completed') === 'true';
      const hasServices = localStorage.getItem('services_completed') === 'true';
      const hasPortfolio = localStorage.getItem('portfolio_completed') === 'true';
      const hasQualifications = localStorage.getItem('qualifications_completed') === 'true';
      const hasTestimonials = localStorage.getItem('testimonials_completed') === 'true';
      
      return hasAbout && hasSkills && hasServices && hasPortfolio && hasQualifications && hasTestimonials;
    }

    function updatePreviewButton() {
      const previewBtn = document.getElementById('previewBtn');
      if (previewBtn) {
        previewBtn.style.display = 'block';
      }
    }

    // Check form completion on page load
    updatePreviewButton();

    // Listen for form submissions to update completion status
    document.addEventListener('formSubmitted', function(e) {
      const formType = e.detail.formType;
      localStorage.setItem(`${formType}_completed`, 'true');
      updatePreviewButton();
    });

    // Delete functions
    async function deleteAbout(id) {
      const result = await Swal.fire({
        title: 'Supprimer ?',
        text: 'Êtes-vous sûr de vouloir supprimer ce profil ? ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      });
      if (!result.isConfirmed) return;
      try {
        const response = await fetch(`{{ base_url }}/api/about/delete/${id}/`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({ icon: 'success', title: 'Profil supprimé !', confirmButtonText: 'OK' });
          loadAboutCard();
        } else {
          Swal.fire({ icon: 'error', title: 'Erreur', text: data.error || 'Erreur lors de la suppression', confirmButtonText: 'OK' });
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Erreur lors de la suppression', confirmButtonText: 'OK' });
      }
    }

    async function deleteSkill(id) {
      const result = await Swal.fire({
        title: 'Supprimer ?',
        text: 'Êtes-vous sûr de vouloir supprimer cette compétence ? ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      });
      if (!result.isConfirmed) return;
      try {
        const response = await fetch(`{{ base_url }}/api/skills/delete/${id}/`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({ icon: 'success', title: 'Compétence supprimée !', confirmButtonText: 'OK' });
          loadSkills();
        } else {
          Swal.fire({ icon: 'error', title: 'Erreur', text: data.error || 'Erreur lors de la suppression', confirmButtonText: 'OK' });
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Erreur lors de la suppression', confirmButtonText: 'OK' });
      }
    }

    async function deleteQualification(id) {
      const result = await Swal.fire({
        title: 'Supprimer ?',
        text: 'Êtes-vous sûr de vouloir supprimer cette qualification ? ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      });
      if (!result.isConfirmed) return;
      try {
        const response = await fetch(`{{ base_url }}/api/qualifications/delete/${id}/`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({ icon: 'success', title: 'Qualification supprimée !', confirmButtonText: 'OK' });
          loadQualifications();
        } else {
          Swal.fire({ icon: 'error', title: 'Erreur', text: data.error || 'Erreur lors de la suppression', confirmButtonText: 'OK' });
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Erreur lors de la suppression', confirmButtonText: 'OK' });
      }
    }

    async function deleteService(id) {
      const result = await Swal.fire({
        title: 'Supprimer ?',
        text: 'Êtes-vous sûr de vouloir supprimer ce service ? ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      });
      if (!result.isConfirmed) return;
      try {
        const response = await fetch(`{{ base_url }}/api/services/delete/${id}/`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({ icon: 'success', title: 'Service supprimé !', confirmButtonText: 'OK' });
          loadServices();
        } else {
          Swal.fire({ icon: 'error', title: 'Erreur', text: data.error || 'Erreur lors de la suppression', confirmButtonText: 'OK' });
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Erreur lors de la suppression', confirmButtonText: 'OK' });
      }
    }

    async function deletePortfolio(id) {
      const result = await Swal.fire({
        title: 'Supprimer ?',
        text: 'Êtes-vous sûr de vouloir supprimer ce projet ? ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      });
      if (!result.isConfirmed) return;
      try {
        const response = await fetch(`{{ base_url }}/api/portfolio/delete/${id}/`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({ icon: 'success', title: 'Projet supprimé !', confirmButtonText: 'OK' });
          loadPortfolio();
        } else {
          Swal.fire({ icon: 'error', title: 'Erreur', text: data.error || 'Erreur lors de la suppression', confirmButtonText: 'OK' });
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Erreur lors de la suppression', confirmButtonText: 'OK' });
      }
    }

    async function deleteTestimonial(id) {
      const result = await Swal.fire({
        title: 'Supprimer ?',
        text: 'Êtes-vous sûr de vouloir supprimer ce témoignage ? ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      });
      if (!result.isConfirmed) return;
      try {
        const response = await fetch(`{{ base_url }}/api/testimonials/delete/${id}/`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({ icon: 'success', title: 'Témoignage supprimé !', confirmButtonText: 'OK' });
          loadTestimonials();
        } else {
          Swal.fire({ icon: 'error', title: 'Erreur', text: data.error || 'Erreur lors de la suppression', confirmButtonText: 'OK' });
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Erreur lors de la suppression', confirmButtonText: 'OK' });
      }
    }
  </script>

  <!-- Floating Preview Button -->
  <div id="previewBtn" class="floating-preview-btn" style="display: block;">
    <a href="/index/{{ user.id }}/" target="_blank" title="Preview Your Portfolio">
      <i class="fas fa-eye"></i>
    </a>
  </div>

  <style>
    .floating-preview-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transition: all 0.3s ease;
      cursor: pointer;
      animation: pulse 2s infinite;
    }

    .floating-preview-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
    }

    .floating-preview-btn a {
      color: white;
      text-decoration: none;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .floating-preview-btn.enabled {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }
      50% {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 0 10px rgba(76, 175, 80, 0.2);
      }
      100% {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }
    }

    @media (max-width: 768px) {
      .floating-preview-btn {
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
      }
      
      .floating-preview-btn a {
        font-size: 20px;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>
</body>
</html>
